<!doctype html>
<html>
<head>
    <title>Haikus - Dominic Joseph</title>
    <link rel="icon" type="image/png" href="./assets/images/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="./css/haikus.css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Great+Vibes' rel='stylesheet' type='text/css'>

    <script type="text/javascript" src="./js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="./js/handlebars-v4.0.5.js"></script>
    <script type="text/javascript" src="./js/moment.min.js"></script>
    <script type="text/javascript" src="./js/QueryData.compressed.js"></script>
</head>
<body>
    <header>
        <div class="inner">
            <a href="/"><img id="insignia" src="./assets/images/insignia.png" alt=""></a>
        </div>
    </header>
    <div id="haikus"></div>
    <div id="controls"></div>
    <footer>&copy; 2018 Dominic Joseph. All rights reserved.</footer>

    <script type="text/javascript">
        Handlebars.registerHelper('haiku', function (text) {
            return new Handlebars.SafeString(text);
        });

        Handlebars.registerHelper('formatDate', function (date) {
            return moment(date).format('MMMM D, YYYY');
        });
    </script>

    <script id="haikuTemplate" type="text/x-handlebars-template">
        {{#each data}}
            <section>
                <h2>{{haiku text}}</h2>
                <p class="haikuTimestamp">Written {{formatDate date}}</p>
            </section>
            <hr>
        {{/each}}
    </script>

    <script id="pagination" type="text/x-handlebars-template">
        <div class="halfLeft">
            {{#if needsPrevPage}}
                <a href="./haikus?page={{prevPage}}">&#60; Previous page</a>
            {{/if}}
        </div>
        <div class="halfRight">
            {{#if needsNextPage}}
                <a href="./haikus?page={{nextPage}}">Next page &#62;</a>
            {{/if}}
        </div>
    </script>

    <script type="text/javascript" src="./haikus.js"></script>
    <script type="text/javascript">
        var pageNumber = Number((new QueryData()).page);
        indexNumber = (!pageNumber || pageNumber < 1) ? 0 : pageNumber - 1;
        pageNumber = indexNumber + 1;

        var haikuSource   = $('#haikuTemplate').html();
        var haikuTemplate = Handlebars.compile(haikuSource);

        var paginationSource   = $('#pagination').html();
        var paginationTemplate = Handlebars.compile(paginationSource);

        haikuSet = haikus.slice(10 * indexNumber, 10 * pageNumber);

        $('#haikus').html(haikuTemplate({data: haikuSet}));
        $('#controls').html(paginationTemplate({
            needsPrevPage: (pageNumber > 1),
            prevPage: pageNumber - 1,
            needsNextPage: (pageNumber < 37),
            nextPage: pageNumber + 1
        }));
    </script>
</body>
</html>
